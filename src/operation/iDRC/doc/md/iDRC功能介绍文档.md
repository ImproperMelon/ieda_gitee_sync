

# **iDRC功能介绍文档**

**编制：** 

**审核：** 

**时间：** 2023年05月06日

---

## **版本修改历史**

| 版本号 | 日期       | 作者 | 简要说明 |
| ------ | ---------- | ---- | -------- |
| 0.10   | 202x-xx-xx |      |          |
|        |            |      |          |
|        |            |      |          |
|        |            |      |          |
|        |            |      |          |

---

## 一、 iDRC目录结构
### 1. api/
实现iDRC与其他子工具交互的接口
### 2. doc/
存放说明文档以及功能手册
### 3. source/
#### 3.1 config/
通过配置文件配置DRC
#### 3.2 data/
##### 3.2.1 basic/
存放iDRC运行需要用到的所有基础数据结构；
| 数据结构              |      介绍                                                                                                                                                                                                                                                                                                                                                |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|  Tech         | 存放从TechFile中读取到的设计规则信息，以层的结构将规则组织起来                                                                                                                                                     |
| DrcLayer      | 存放某一层的所有TechFile规定的所有设计规则要求；每个Layer都与Tech LEF中的Layer相对应。                                             |
| DrcDesign    | 版图设计信息的顶层数据结构                      |
| DrcNet   | 存放版图中的一条net；包含一条net的通孔、金属线、与之相连的Pin、以及根据金属线和Pin构建出的Poly结构                 |
| DrcPoly   |  由一条net中相互交叠的金属线、Enclosure以及Pin融合而来，形成的多边矩形结构。        |
| DrcPolygon     | 仅存放DrcPoly中的几何信息。                                          |
| DrcRect    | 表示设计中的obj，可以是一个金属线段、也可以是一个Enclosure或者是一个Cut       |
| DrcRectangle   | 仅存放DrcRect中的几何信息。         |
| DrcViolationSpot   | 包含违例报告信息的结构体，包括坐标信息，违例类型等。                |

##### 3.2.2 rule/
存放TechFile中的DRC规则，目前已经弃用，使用iDB中定义的规则数据结构。
##### 3.2.3 iDBWrapper
包装来自iDB中的数据，构建iDRC所需的数据结构。
#### 3.3 module/
##### 3.3.1 multi_patterning/
已弃用
##### 3.3.2 region_query/
区域查询模块是在检查时用到的工具，内含多个R树，R树存放版图几何信息，使用Boost库中的R树接口实现，供检查时使用；主要用途如下：
* 用于存放版图的几何信息，查询某一几何区域与版图上其他几何物体的关系；
* 用于存放违例报告的几何图形，防止违例的重复报告；
* 用于存放版图几何物体的影响范围，实现DrcAPI相关功能；
##### 3.3.3 shape_check/
实现针对非Spacing类型规则的检查，主要包括MinStep、Width、Area、Enclosure相关规则的检查；
| 检查类型              |      介绍                                                                                                                                                                                                                                                                                                                                                |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|  最小步长（MinStep）规则  |  该规则要求金属线外边缘不可以有超过 TechFile 限定个数的边长小于TechFile规定值的连续边；如图1.1所示                                                                                            |
| 通孔包围（Enclosure）规则   |     通孔包围规则规定了某一个Cut上下层的金属包围与Cut边缘的最小距离，超过这些距离会发生Enclosure违例，如图1.2所示     |
|  最小宽度规则      | 最小宽度规则是用于约束版图中导体图形的内边间距(Distance of interior facing edge)如图1.3(a)所示，它规定了导体图形的内边间距不得小于TechFile规定的最小宽度参数值，包括导体的长度，导体的宽度，导体的内对角宽度，如下图1.3中(b),(c),(d)所示。                                             |
|   最小面积规则    |最小面积规则规定了各个工艺层的导体面积不能小于TechFile中指定的最小面积参参数值，如下图1.4左图中的Area示意                                                |
|  最小孔洞面积规则   | 最小包围面积规定了由导体环绕包围形成的孔洞面积不能小于TechFile指定的最小面积参数值，如下图1.4右图中的Enclosed Area示意。                                             |

<img src="图片/minstep.png" style="zoom:80%;" />

​                                               图1.1 最小步长规则对应的检查对象

<img src="图片/enclosure.png" style="zoom:60%;" />

​                                               图1.2 通孔包围规则对应的检查对象

<img src="图片/图片1.3.png" style="zoom:60%;" />

​                                               图1.3 导体图形的内边间距（最小宽度规则对应的检查对象）
​                                                 

<img src="图片/图片1.4.png" style="zoom:50%;" />

​                                               图1.4 左图为导体图形的面积（最小面积规则对应的检查对象）

​                                                         右图为导体图形包围形成的孔洞面积（最小包围面积规则对应的检查对象）

##### 3.3.4 spacing_check/
| 名词              | 名词解释                                                                                                                                                                                                                                                                                                                                                     |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 短路违规          | 当所属不同线网的导体几何图形产生任何形式的交叠，都会产生短路，比如，所属不同线网的线段(Wire)，所属不同线网的Pin和通孔Via，线网图形和障碍物Block，它们之间的触碰都是不允许的，都被视为短路违规如下图1.5所示。                                                                                                                                                     |
| 金属最小间距规则      | 最小间距规则可以理解为版图中导体图形间的外边间距(Distance of exterior facing edge)不得小于TechFile中规定的当前工艺层的最小间距参数值,导体间的外边间距，如下图1.2(a)所示，间距规则包括检查导体间X方向的间距，Y方向间距，与角间距，如图1.6所示。                                             |
| 金属最小线端（EOL）间隔规则    | 该规则要求在TechFile中要求的金属线末端的区域内不可以有其他的金属线与该区域产生交叠；区域的可能大小受到线端边（EOL）的邻接边长度、附近是否有通孔以及相邻金属线等因素影响，如图1.7所示。                      |
| 金属最小凹槽（Notch）间隔规则    | 该规则要求在符合TechFile规定条件的由金属线形成凹槽区域中，凹槽的底部长度不得小于规定值，如图1.8所示。                    |
| 金属最小Jog间隔规则    | 该规则要求在一个较宽金属线与其邻近的Parallel Run Length长度符合 TechFile要求的金属线之间存在的某些特定的金属之间的间隔要求，如图1.9所示。            |
| 金属最小CornerFill间隔规则    | 该规则要求在金属线外边缘存在符合TechFile要求的拐角处缺口型区域时，在该缺口处虚拟出一块金属，检查该虚拟出的金属与其他金属的间隔，如图1.10所示。          |
| Cut最小间隔规则    | 该规则要求同一Cut层中的任何两个Cut之间的间隔不能小于规定值,Cut层的Spacing计算虽然一般默认为edge-to-edge的欧式距离，但有些情况下会因为规则中的某些字段而发生改变，某些情况下会以两者在X、Y方向上的最大投影长度来代替欧式距离来计算Spacing，如图1.11所示。          |

<img src="图片/图片1.1.png" style="zoom:80%;" />

​                                               图1.5 短路违规情况

<img src="图片/图1.2.png" style="zoom:80%;" />

​                                               图1.6 导体图形外边间距示意图（最小间距规则对应检查对象）

<img src="图片/EOL.png" style="zoom:80%;" />

​                                               图1.7  金属最小线端（EOL）间隔规则对应的检查对象

<img src="图片/notch.png" style="zoom:80%;" />

​                                               图1.8 金属最小凹槽（Notch）间隔规则对应的检查对象

<img src="图片/jog.png" style="zoom:50%;" />

​                                               图1.9 金属最小Jog间隔规则对应的检查对象

<img src="图片/corner_fill.png" style="zoom:50%;" />

​                                               图1.10 金属最小CornerFill间隔规则对应的检查对象

<img src="图片/cut_spacing.png" style="zoom:100%;" />

​                                               图1.11 Cut最小间隔规则对应的检查对象
##### 3.3.5 spot_parser/
已弃用
#### 3.4 util/
### 4. test/
用于存放单元测试文件


## 二、iDRC command
### 2.1 run_drc
读取Def、Lef文件，进行DRC检查，并输出DRC全局报告

```tcl
run_drc -config $config -path $gloabal_drc_report_file_path
```
### 2.2 save_drc
保存并输出DRC检查详细报告；需要先run_drc得到检查结果
```tcl
run_drc -config $config -path $gloabal_drc_report_file_path
save_drc -path $detail_drc_report_file_path
```
### 2.3 read_drc
读取DRC详细报告
```tcl
read_drc -path $detail_drc_report_file_path
```
### 2.4 init_drc 
从DataManager中初始化DRC所需Tech和Design数据
```tcl
init_drc
```

### 2.5 check_drc
从DataManager中初始化DRC所需数据并进行检查，输出全局报告到终端
```tcl
check_drc
```
### 2.6 destroy_drc
销毁DRC
```tcl
destroy_drc
```
### 2.7 init_drc_api
从DataManeger中初始化DrcAPI所需的Tech数据
```tcl
init_drc_api
```
### 2.8 destroy_drc_api
销毁DrcAPI
```tcl
destroy_drc_api
```
### 2.9 check_net
检查指定net的是否连通
```tcl
check_net -name $net_name
```
### 2.10 check_all_net
检查所有net的是否连通
```tcl
check_all_net
```




